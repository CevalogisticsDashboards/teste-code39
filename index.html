<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escaneador de Códigos de Barras</title>
    <!-- Incluindo a biblioteca QuaggaJS via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #video {
            width: 100%;
            max-width: 500px;
            height: auto;
            position: relative;
        }
        #result {
            width: 90%;
            margin: 10px auto;
            padding: 10px;
            font-size: 16px;
        }
        #startButton {
            padding: 10px 20px;
            font-size: 16px;
            margin: 10px;
        }
        /* Quadrado de alinhamento */
        .scan-area {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 20%;
            border: 2px dashed red;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <h2>Escaneador de Códigos de Barras</h2>
    <!-- Campo de texto para o resultado -->
    <input type="text" id="result" placeholder="Resultado aparecerá aqui" readonly>
    <!-- Botão para iniciar o escaneamento -->
    <button id="startButton">Iniciar Escaneamento</button>
    <!-- Div para o vídeo -->
    <div id="video" style="position: relative;"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const resultInput = document.getElementById('result');
            const startButton = document.getElementById('startButton');
            let scanning = false;

            // Função para parar o escaneamento
            function stopScanning() {
                if (scanning) {
                    Quagga.stop();
                    scanning = false;
                }
            }

            // Função para iniciar o escaneamento
            function startScanning() {
                if (scanning) return;
                scanning = true;

                // Configuração do QuaggaJS
                Quagga.init({
                    inputStream: {
                        name: "Live",
                        type: "LiveStream",
                        target: document.querySelector('#video'),
                        constraints: {
                            facingMode: "environment" // Usa a câmera traseira
                        }
                    },
                    decoder: {
                        readers: [
                            "code_39_reader", // Para Code 39
                            "code_128_reader", // Para Code 128
                            "ean_reader", // Para EAN-13, EAN-8
                            "upc_reader" // Para UPC-A, UPC-E
                        ]
                    },
                    locate: true
                }, function(err) {
                    if (err) {
                        console.error('Erro ao iniciar Quagga:', err);
                        alert('Não foi possível iniciar o escaneador. Verifique as permissões da câmera.');
                        scanning = false;
                        return;
                    }
                    Quagga.start();

                    // Adiciona o quadrado de alinhamento
                    if (!document.querySelector('.scan-area')) {
                        const scanArea = document.createElement('div');
                        scanArea.className = 'scan-area';
                        document.querySelector('#video').appendChild(scanArea);
                    }
                });

                // Evento de detecção
                Quagga.onDetected(function(data) {
                    const code = data.codeResult.code;
                    resultInput.value = code;
                    stopScanning();
                });
            }

            // Evento do botão
            startButton.addEventListener('click', startScanning);
        });
    </script>
</body>
</html>
